<!DOCTYPE html>

<html lang="en" class="app" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>ME+预约－租借管理</title>
    <meta name="description"
          content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="stylesheet" href="/css/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="/css/animate.css" type="text/css"/>
    <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css"/>
    <link rel="stylesheet" href="/css/simple-line-icons.css" type="text/css"/>
    <link rel="stylesheet" href="/css/font.css" type="text/css"/>
    <link rel="stylesheet" href="/css/app.css" type="text/css"/>
</head>
<body>
<section class="vbox">
    <!-- header -->
    <header
            class="bg-white-only header header-md navbar navbar-fixed-top-xs">
        <div class="navbar-header aside bg-info nav-xs">
            <a class="btn btn-link visible-xs"
               data-toggle="class:nav-off-screen,open" data-target="#nav,html">
                <i class="icon-list"></i>
            </a> <a href="index.html" class="navbar-brand text-lt"> <i
                class="icon-earphones"></i> <img src="/images/logo.png" alt="."
                                                 class="hide"> <span class="hidden-nav-xs m-l-sm">ME+</span>
        </a> <a class="btn btn-link visible-xs" data-toggle="dropdown"
                data-target=".user"> <i class="icon-settings"></i>
        </a>
        </div>
        <ul class="nav navbar-nav hidden-xs">
            <li><a href="#nav,.navbar-header"
                   data-toggle="class:nav-xs,nav-xs" class="text-muted"> <i
                    class="fa fa-indent text"></i> <i class="fa fa-dedent text-active"></i>
            </a></li>
        </ul>
        <form
                class="navbar-form navbar-left input-s-lg m-t m-l-n-xs hidden-xs"
                role="search">
            <div class="form-group">
                <div class="input-group">
						<span class="input-group-btn"><button type="submit"
                                                              class="btn btn-sm bg-white btn-icon rounded">
								<i class="fa fa-search"></i>
							</button></span> <input type="text"
                                                    class="form-control input-sm no-border rounded"
                                                    placeholder="ME+搜索">
                </div>
            </div>
        </form>
        <div class="navbar-right ">
            <ul class="nav navbar-nav m-n hidden-xs nav-user user">
                <li class="hidden-xs"><a href="#" class="dropdown-toggle lt"
                                         data-toggle="dropdown"> <i class="icon-bell"></i> <span
                        class="badge badge-sm up bg-danger count">2</span>
                </a>
                    <section class="dropdown-menu aside-xl animated fadeInUp">
                        <section class="panel bg-white">
                            <div class="panel-heading b-light bg-light">
                                <strong>You have <span class="count">2</span>
                                    notifications
                                </strong>
                            </div>
                            <div class="list-group list-group-alt">
                                <a href="#" class="media list-group-item"> <span
                                        class="pull-left thumb-sm"> <img src="/images/a0.png"
                                                                         alt="..." class="img-circle">
									</span> <span class="media-body block m-b-none"> Use awesome
											animate.css<br> <small class="text-muted">10
												minutes ago</small>
									</span>
                                </a> <a href="#" class="media list-group-item"> <span
                                    class="media-body block m-b-none"> 1.0 initial released<br>
											<small class="text-muted">1 hour ago</small>
									</span>
                            </a>
                            </div>
                            <div class="panel-footer text-sm">
                                <a href="#" class="pull-right"><i class="fa fa-cog"></i></a> <a
                                    href="#notes" data-toggle="class:show animated fadeInRight">See
                                all the notifications</a>
                            </div>
                        </section>
                    </section>
                </li>
                <li class="dropdown"><a href="#"
                                        class="dropdown-toggle bg clear" data-toggle="dropdown"> <span
                        class="thumb-sm avatar pull-right m-t-n-sm m-b-n-sm m-l-sm">
								<img src="http://resource.mjiahome.com/img-dir/1495787315dSACiaRyPH.jpg"
                                     th:attr="src=${session.user.getAvatar()}" alt="..."/>
						</span><span th:text="${session.user.getNickName()}"></span><b class="caret"></b></a>
                    <ul class="dropdown-menu animated fadeInRight">
                        <li><span class="arrow top"></span><a href="#">设置</a></li>
                        <li><a href="profile.html">简介</a></li>
                        <li><a href="#"><span class="badge bg-danger pull-right">3</span>通知</a></li>
                        <li><a href="docs.html">帮助</a></li>
                        <li class="divider"></li>
                        <li><a href="modal.lockme.html" data-toggle="ajaxModal">退出</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </header>
    <!-- /header -->

    <!-- section -->
    <section>
        <section class="hbox stretch">

            <!-- .aside -->
            <aside class="bg-black dk nav-xs aside hidden-print" id="nav">
                <section class="vbox">
                    <section class="w-f-md scrollable">
                        <div class="slim-scroll" data-height="auto"
                             data-disable-fade-out="true" data-distance="0" data-size="10px"
                             data-railOpacity="0.2">

                            <!-- nav -->
                            <nav class="nav-primary hidden-xs">
                                <ul class="nav" data-ride="collapse">
                                    <li><a href="#" class="auto"><span
                                            class="pull-right text-muted"><i
                                            class="fa fa-angle-left text"></i><i
                                            class="fa fa-angle-down text-active"></i></span><i
                                            class="icon-screen-desktop icon"></i><span>企业应用平台1.0</span></a>
                                        <ul class="nav dk text-sm">
                                            <li><a href="index.html" class="auto"><i
                                                    class="fa fa-angle-right text-xs"></i><span>企业用户管理</span>
                                            </a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#" class="auto"><span
                                            class="pull-right text-muted"><i
                                            class="fa fa-angle-left text"></i><i
                                            class="fa fa-angle-down text-active"></i></span><i
                                            class="icon-grid icon"></i><span>平台后台1.0</span> </a>
                                        <ul class="nav dk text-sm">
                                            <li><a href="/html/platform/lease.html" class="auto"><i
                                                    class="fa fa-angle-right text-xs"></i><span>预约－租借管理</span></a></li>
                                            <li><a href="/html/platform/product.html" class="auto"><i
                                                    class="fa fa-angle-right text-xs"></i><span>产品资源管理</span></a></li>
                                            <li><a href="/html/platform/user.html" class="auto"><i
                                                    class="fa fa-angle-right text-xs"></i><span>用户资源管理</span></a></li>
                                            <li><a href="/html/platform/cooperation.html" class="auto"><i
                                                    class="fa fa-angle-right text-xs"></i><span>合作企业</span></a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </nav>
                            <!-- / nav -->

                        </div>
                    </section>
                </section>
            </aside>
            <!-- /.aside -->
            <section id="content">
                <section class="vbox">
                    <section class="scrollable padder" >
                        <div class="m-b-md">
                            <h3 class="m-b-none"></h3>
                        </div>
                        <div class="m-b-md">
                            <h3 class="m-b-none"></h3>
                        </div>
                        <div class="m-b-md">
                            <h3 class="m-b-none"></h3>
                        </div>
                        <div class="m-b-md">
                            <h3 class="m-b-none"></h3>
                        </div>
                    <div class="main">
                        <div class="formData row">
                            <span class="col-md-1"><label>订单状态：</label></span> <span
                                class="col-md-2"> <select
                                class="form-control input-group-md" id="orderStatus">
													<option value="all" selected="selected">全部</option>
													<option value="0">新预约</option>
													<option value="1">确认中</option>
													<option value="2">已经确认</option>
													<option value="3">入住</option>
													<option value="4">结束</option>
													<option value="5">取消</option>
											</select>
											</span> <span class="col-md-1"><input type="text" class="form-control" placeholder="产品名称" aria-describedby="basic-addon2" id="productName"></span> <span
                                class="col-md-1"><input type="text"
                                                        class="form-control" placeholder="房源名称"
                                                        aria-describedby="basic-addon2" id="houseSubject"></span> <span
                                class="col-md-1"><input type="text"
                                                        class="form-control" placeholder="用户ID"
                                                        aria-describedby="basic-addon2" id="biller"></span> <span
                                class="col-md-1"><button type="button"
                                                         class="btn btn-primary" id="btn_search">查询</button></span>
                            <span
                                    class="col-md-2 text-right" id="nextMonth"><button type="button"
                                                                                       class="btn btn-default">未来一个月内到期房源</button></span>
                            <span
                                    class="col-md-2"><button type="button"
                                                             class="btn btn-default"
                                                             id="nextThreeDay">未来3d内到期房源</button></span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped b-t b-light">
                                <thead>
                                <tr style="height: 40px;">
                                    <th class="text-center" style="vertical-align: middle">订单ID</th>
                                    <th class="text-center" style="vertical-align: middle">产品名称</th>
                                    <th class="text-center" style="vertical-align: middle">房源名称</th>
                                    <th class="text-center" style="vertical-align: middle">用户ID</th>
                                    <th class="text-center" style="vertical-align: middle">订单金额</th>
                                    <th class="text-center" style="vertical-align: middle">平台应收款</th>
                                    <th class="text-center" style="vertical-align: middle">供应商应收款</th>
                                    <th class="text-center" style="vertical-align: middle">租借周期</th>
                                    <th class="text-center" style="vertical-align: middle">是否平台押金托管</th>
                                    <th class="text-center" style="vertical-align: middle">线上／线下支付</th>
                                    <th class="text-center" style="vertical-align: middle">线上支付渠道</th>
                                    <th class="text-center" style="vertical-align: middle">线上支付账户</th>
                                    <th class="text-center" style="vertical-align: middle">线上支付时间</th>
                                    <th class="text-center" style="vertical-align: middle">订单状态</th>
                                    <th class="text-center" style="vertical-align: middle">最后处理时间</th>
                                    <th class="text-center" style="vertical-align: middle">操作</th>
                                </tr>
                                </thead>
                                <tbody id="table_body">

                                </tbody>
                            </table>
                            <!-- 分页 -->
                            <!-- <div class="text-right text-center-xs">
                                <ul class="pagination pagination-sm m-t-none m-b-none">
                                    <li><a href="#"><i class="fa fa-chevron-left"></i></a></li>
                                    <li><a href="#">1</a></li>
                                    <li><a href="#">2</a></li>
                                    <li><a href="#">3</a></li>
                                    <li><a href="#">4</a></li>
                                    <li><a href="#">5</a></li>
                                    <li><a href="#"><i class="fa fa-chevron-right"></i></a></li>
                                </ul> -->
                        </div>
                        <footer class="panel-footer">
                            <div class="row">
                                <div class="col-sm-4 hidden-xs">
                                </div>
                                <div class="col-sm-4 text-center">

                                </div>
                                <div class="col-sm-4 text-right text-center-xs">
                                    <ul id="page_index" class="pagination pagination-sm m-t-none m-b-none">
                                    </ul>
                                </div>
                            </div>
                        </footer>

                        <!-- 弹出框 -->
                        <div class="panel panel-primary" id="payList"
                             style="display: none;">
                            <div class="panel-heading">确认订单</div>
                            <div class="panel-body">
                                <span>租借周期&nbsp;&nbsp;日历控件，选择入住起始时间~入住结束时间，不得与房源可用时间重叠</span>
                                <span>是否选择押金平台托管：<label><input type="radio"
                                                               name="optionsRadios" id="optionsRadios1" value="option1"
                                                               checked>&nbsp;是</label>&nbsp;&nbsp;&nbsp;&nbsp;<label><input
                                        type="radio" name="optionsRadios" id="optionsRadios2"
                                        value="option2">&nbsp;否</label></span>
                                <p class="text-center">
                                    <button type="button" class="btn btn-primary btn-sm">取
                                        消
                                    </button>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                    <button type="button" class="btn btn-primary btn-sm">确
                                        认
                                    </button>
                                </p>
                            </div>
                        </div>

                    </div>
                    </div>
            </section>
                </section>
                <a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen,open"
                   data-target="#nav,html"></a>
            </section>
        </section>
    </section>
</section>
<script src="/js/jquery.min.js"></script>
<script type="application/javascript" th:inline="javascript">
    var pageSize = 10;
    var pageNow = 1;
    var total = 0;
    var pageNum = 1;
    $(function () {
        requestOrderList();
        $("#btn_search").click(function () {
            pageNow = 1;
            requestOrderList();
        });
    });
    function calPageNum() {
        if (total == 0) {
            pageNum = 1;
        }
        if (total % pageSize == 0) {
            pageNum = total / pageSize;
        } else {
            pageNum = parseInt(total / pageSize) + 1;
        }
        $('#page_index').empty();
        var pre = '<div class="btn-group m-b-sm">' +
            '<button type="button" onclick="pagePrevious()" class="btn btn-default"><i class="fa fa-arrow-left"></i></button>';
        var center = '';
        for (var index = 1; index <= pageNum; index++) {
            if (index == pageNow) {
                center += '<button type="button" onclick="pageClear(' + index + ')" class="btn btn-success">' + index + '</button>';
            } else {
                center += '<button type="button" onclick="pageClear(' + index + ')" class="btn btn-default">' + index + '</button>';
            }
        }
        var follow = '<button type="button" onclick="pageFollowing()" class="btn btn-default"><i class="fa fa-arrow-right"></i></button>' +
            '</div>';
        $('#page_index').append(pre + center + follow);
    }
    function pagePrevious() {
        pageNow--;
        requestOrderList();
    }
    function pageFollowing() {
        pageNow++;
        requestOrderList();
    }
    function pageClear(page) {
        pageNow = page;
        requestOrderList();
    }
    function requestOrderList() {
        var orderStatus = $("#orderStatus").val();
        var productName = $("#productName").val();
        var houseSubject = $("#houseSubject").val();
        var biller = $("#biller").val();

        if (pageNow < 1) {
            pageNow = 1;
        }
        if (pageNow > pageNum) {
            pageNow = pageNum;
        }
        var data = {
            'pageNow': pageNow,
            'pageSize': pageSize
        };
        if (orderStatus.length > 0 && orderStatus != 'all') {
            data['orderStatus'] = orderStatus;
        }
        if (productName != '') {
            data['productName'] = productName;
        }
        if (houseSubject != '') {
            data['houseSubject'] = houseSubject;
        }
        if (biller != '') {
            data['biller'] = biller;
        }
        $.ajax({
            type: "POST",
            async: true,
            url: "/api/order/list",
            contentType: "application/json",
            data: JSON.stringify(data),
            dataType: "json",
            success: function (ret) {
                $("#table_body").empty();
                total = ret['totalCount'];
                $.each(ret['result'], function (item, val) {
                    buildTr(val);
                });
                $("#span_total").html(total);
                calPageNum();
            },
            error: function (message) {
            }
        });
    }
    function buildTr(item) {
        var platformHostStr = item['platformHost'];
        var payOnlineStr = item['payOnline'];
        var orderStatus = item['orderStatus'];
        var platformHost = '是';
        var payOnline = '线上';
        if (platformHostStr == 'FALSE') {
            platformHost = '不是';
        }
        if (payOnlineStr == 'FALSE') {
            payOnline = '线下';
        }
        var operation = '<a class="btn btn-xs btn-success btn-rounded" id="orderBegin">开始处理</a>｜<a class="btn btn-xs btn-success btn-rounded" id="orderCancel">取消订单</a>';
        if (orderStatus == 1) {
            operation = '<a class="btn btn-xs btn-success btn-rounded" id="orderConfirm">确认订单</a>｜<a class="btn btn-xs btn-success btn-rounded" id="orderCancel">取消订单</a>';
        }
        if (orderStatus >= 2) {
            operation = '<a class="btn btn-xs btn-success btn-rounded" id="updateRentTime">变更租借周期</a>｜<a class="btn btn-xs btn-success btn-rounded" id="holdChoose">选择押金平台托管</a>｜<a class="btn btn-xs btn-success btn-rounded" id="orderCancel">取消订单</a>';
        }
        if (orderStatus == 5) {
            operation = '<a class="btn btn-xs btn-success btn-rounded" id="depositBack">退还押金</a>'
        }
        var txt =
            '<tr style="height: 60px;">' +
            '<td style="vertical-align: middle" class="text-center">' + item['orderId'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['productName'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['houseSubject'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['biller'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['discountAmount'] * 0.01 + '元</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['platFormAmount'] * 0.01 + '元</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['supplierAmount'] * 0.01 + '元</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['tenancy'] + '月</td>' +
            '<td style="vertical-align: middle" class="text-center">' + platformHost + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + payOnline + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['payTypeDesc'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['payAccount'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['payTime'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['orderStatusDesc'] + '</td>' +
            '<td style="vertical-align: middle" class="text-center">' + item['updateTime'] + '</td>' +
            //'<td style="vertical-align: middle" class="text-center"><a href="/html/platform/companyinfo.html?op=update&code=' + item['companyId'] + '" class="btn btn-xs btn-success btn-rounded">编辑</a></td>' +
            '<td style="vertical-align: middle" class="text-center">' + operation + '</td>' +
            '</tr>';
        $("#table_body").append(txt);
    }

</script>
<!-- Bootstrap -->

<!-- Bootstrap -->
<script src="/js/bootstrap.js"></script>
<!-- App -->
<script src="/js/app.js"></script>
<script src="/js/slimscroll/jquery.slimscroll.min.js"></script>
<script src="/js/app.plugin.js"></script>
</body>
</html>
