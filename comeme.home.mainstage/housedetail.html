<!DOCTYPE HTML>
<html lang="zh-cn">
<head>
<!--<base href="http://127.0.0.1:8020/comeme.home.mainstage/"/>-->
<base href="http://m.mjiahome.com/"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name = "format-detection" content="telephone=no">
<meta name="viewport"  content="width=device-width,user-scalable=no">
<title>Me+房间详情</title>
<meta name="keywords" content="ME+">
<meta name="description" content="ME+">
<link rel="stylesheet" type="text/css" href="css/swiper.min.css" />
<link rel="stylesheet" type="text/css" href="css/base.css" />
<link rel="stylesheet" type="text/css" href="css/common.css" />
<link rel="stylesheet" type="text/css" href="css/detail.css" />
<script src="js/jquery.min.js"></script>
<script src="js/swiper.min.js"></script>
<script src="js/detail.js"></script>
<script src="js/util.js"></script>
</head>
<body>
    
    <div class="wrap">
    
    	<!-- header -->
    	<header class="bannerDetail">
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="img/test/test3.jpg" /></div>
                    <div class="swiper-slide"><img src="img/test/test3.jpg" /></div>
                    <div class="swiper-slide"><img src="img/test/test3.jpg" /></div>
                    <div class="swiper-slide"><img src="img/test/test3.jpg" /></div>
                    <div class="swiper-slide"><img src="img/test/test3.jpg" /></div>
                </div>
                <!-- Add Pagination -->
                <div class="swiper-pagination"></div>
            </div>
        </header>
        
        <section class="section">
        	<div class="houseInfo" id="div_house">
            </div>
            
            <div class="housePt">
            	<h3><em></em>配套设施</h3>
                <ul id="ul_basic">
                	<!--<li><em class="iconBed"></em><i>床</i></li>
                    <li><em class="iconYg"></em><i>衣柜</i></li>
                    <li><em class="iconCz"></em><i>餐桌</i></li>
                    <li><em class="iconTv"></em><i>电视机</i></li>
                    <li><em class="iconKt"></em><i>空调</i></li>
                    <li><em class="iconRsq"></em><i>热水器</i></li>
                    <li><em class="iconNet"></em><i>无线网</i></li>
                    <li><em class="iconCyj"></em><i>油烟机</i></li>
                    <li><em class="iconCg"></em><i>橱柜</i></li>-->
                </ul>
            </div>
        </section>
        
        <!-- footer -->
        <a class="btn btnYy" onclick="appointment();">立即预约</a>
        
    </div>
    
    <!-- 预约成功 -->
    <div class="pop popYy" id="div_popSuccess">
    	<em class="iconSuccess"></em>
    	<span>预约成功</span>
    </div>
    
    <!-- 注册成功 -->
    <div class="pop popFail2" id="div_popFail">
    	<em class="iconFail"></em>
    	<span id="span_pop">预约失败</span>
    </div>
    
    <div class="popBox" id="div_popbox">
    	<h3>是否确认预约？</h3>
        <span>预约成功后官方客服会尽快与您联系！<br>请耐心等待哦～</span>
        <div class="btnPop"><a class="btnCancel" onclick="isAppointment(0);">取消</a><a class="btnQd2" onclick="isAppointment(1);">确定</a></div>
    </div>
    
    <div class="mask"></div>
    
</body>
<script type="text/javascript">
	var util;
	var isSubmit = 0;
	//页面初始化
	$(function(){
		util = new Util();
		
		//加载房源详细
		loadHouseDetail();
		//加载产品基础设施
		loadProductBasic();
		//刷新个人信息
		flushUerInfo();
	});
	
	//加载房源详细
	function loadHouseDetail(){
		var houseId = util.getUrlParam('houseId');
		var url = util.baseUrl + '/house/list';
		var param ='{"houseId": '+houseId+'}';
		var contentType = "application/json";
		util.requestRemoteDataJsonPost(url,param,contentType,function(data){
			util.logResult(data); 
			$.each(data.result,function(index,houseInfo){
				if(index == 0){
					var roomTypeDesc = eval('(' + houseInfo.roomTypeDesc + ')');
					var room_type_des =  roomTypeDesc.room +'室'+roomTypeDesc.hall+'厅'+roomTypeDesc.toilet+'卫';
					var payType = eval('(' + houseInfo.payType + ')');
					var pay_type_des = '押'+payType.mortagageNum+'付'+payType.payMentNum;
					var house_html =  ' <h3>'+houseInfo.subject+'</h3>'
					 				+ '	<span><i>'+pay_type_des+'</i>'+room_type_des+' '+houseInfo.roomArea+'㎡</span>'
					 				+ '	<em>'+houseInfo.roomRent+'元／月</em>';
					$('#div_house').append(house_html);
				}
			});
		});
	}
	//加载产品基础设施
	function loadProductBasic(){
		var productId = util.getUrlParam('productId');
		var url = util.baseUrl + '/product/list';
		var param ='{"productId": '+productId+'}';
		var contentType = "application/json";
		util.requestRemoteDataJsonPost(url,param,contentType,function(data){
			util.logResult(data);
			$.each(data.result,function(index,productInfo){
				if(index == 0){
					var basicList =productInfo.basicList;
					util.logResult(basicList);
					$.each(productInfo.basicList,function(basicIndex,basicInfo){
						var li_html = '<li><em style="background:url('+basicInfo.pic+') no-repeat; background-size:30px 31px;"></em><i>'+basicInfo.basicName+'</i></li>';
						$('#ul_basic').append(li_html);
					});
				}
			});
		});
	}
	
	//立即预约
	function appointment(){
		$('#div_popbox').fadeIn();
	}
	
	//是否预约
	function isAppointment(flag){
		if(flag == 0){
			$('#div_popbox').fadeOut();
		}else{
			flushUerInfo();
			var houseId = util.getUrlParam('houseId');
			var userInfo = util.getCookie("userInfo");
			if(userInfo == null || userInfo == ''){
				$('#div_popbox').fadeOut();
				$('#span_pop').html('请先登录!');
				$( '#div_popFail' ).fadeIn();
				setTimeout( function(){$( '#div_popFail' ).fadeOut();}, ( 1* 1000 ) );
				return false;
			}
			var userInfoJson = eval('(' + userInfo + ')');
			var userId = userInfoJson.userId;
			var url = util.baseUrl + '/order/placeOrder';
			var param ='{"houseId":'+houseId+',"biller":'+userId+'}';
			var contentType = "application/json";
			util.requestRemoteDataJsonPost(url,param,contentType,function(data){
				util.logResult(data); 
				var errorCode = data.code;
				util.logResult(errorCode); 
				if(errorCode == 0){
					$('#div_popbox').fadeOut();
					$( '#div_popSuccess' ).fadeIn();
					setTimeout( function(){$( '#div_popSuccess' ).fadeOut();}, ( 1 * 1000 ) );
				}else{
					$('#div_popbox').fadeOut();
					$( '#div_popFail' ).fadeIn();
					setTimeout( function(){$( '#div_popFail' ).fadeOut();}, ( 1 * 1000 ) );
				}
			});
		}
	}
	
	//刷新个人信息
	function flushUerInfo(){
		var userInfo = util.getCookie("userInfo");
		if(userInfo != null && userInfo != ''){
			var userInfoJson = eval('(' + userInfo + ')');
			util.logResult(userInfoJson);
			var userId = userInfoJson.userId;
			var updateTime = userInfoJson.updateTime;
			var url = util.baseUrl + '/usr/get'; 
			var param ='{"userId": '+userId+'}';
			var contentType = "application/json";
			util.requestRemoteDataJsonPosta(url,param,contentType,function(data){
				var result = data.result;
				if(result == null || result == undefined){
					util.setCookie("userInfo", '');
				}
				var newUpdateTime = result.updateTime;
				util.logResult(newUpdateTime+' '+updateTime);
				if(newUpdateTime != updateTime){
					util.setCookie("userInfo", '');
				}
				
			});
		}
	}
	
</script>
</html>